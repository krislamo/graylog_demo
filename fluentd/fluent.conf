<source>
  @type forward
  port 24224
</source>

<source>
  @type syslog
  port 5140
  tag system
</source>

<source>
  @type tail
  path /var/log/hostlogs/httpd/access_log
  pos_file /var/log/hostlogs/httpd/access_log.pos
  tag httpd.access
  <parse>
    @type apache2
  </parse>
</source>

<match devel.*>
  @type copy
  <store>
    @type file
    path /var/log/hostlogs/containers/${tag}
    append true
    <buffer tag>
      timekey 5s
      flush_mode immediate
    </buffer>
  </store>
  <store>
    @type rewrite_tag_filter
    <rule>
      key container_name
      pattern /\/(.+)/
      tag ${tag}.$1
    </rule>
  </store>
</match>

<match **>
  @type gelf
  host vagrant_graylog_1
  port 12201
  protocol tcp
  #tls true
  #tls_options {"cert":"/fluentd/etc/pki/fluentd-signed.crt",
  #             "key":"/fluentd/etc/pki/fluentd.key"}
  flush_interval 5s
</match>
